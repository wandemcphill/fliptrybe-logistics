services:
  # --- üõ∞Ô∏è NODE 1: THE WEB ENGINE ---
  - type: web
    name: fliptrybe-web
    plan: starter
    runtime: python
    buildCommand: "./build.sh"
    startCommand: "gunicorn run:app"
    envVars:
      - key: DATABASE_URL
        fromDatabase:
          name: fliptrybe-db
          property: connectionString
      - key: REDIS_URL
        fromService:
          type: redis
          name: fliptrybe-cache
          property: connectionString
      - fromGroup: fliptrybe-secrets

  # --- üöÅ NODE 2: THE SIGNAL WORKER (CELERY) ---
  - type: worker
    name: fliptrybe-worker
    plan: starter
    runtime: python
    buildCommand: "./build.sh"
    startCommand: "celery -A run.celery worker --loglevel=info"
    envVars:
      - key: DATABASE_URL
        fromDatabase:
          name: fliptrybe-db
          property: connectionString
      - key: REDIS_URL
        fromService:
          type: redis
          name: fliptrybe-cache
          property: connectionString
      - fromGroup: fliptrybe-secrets

  # --- üß™ NODE 3: THE CACHE (REDIS) ---
  - type: redis
    name: fliptrybe-cache
    plan: free
    ipAllowList: []

# --- Vault: THE INDUSTRIAL DATABASE (POSTGRES) ---
databases:
  - name: fliptrybe-db
    plan: starter