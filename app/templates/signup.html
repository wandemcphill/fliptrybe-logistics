{% extends "base.html" %}
{% block content %}
<div class="min-h-screen bg-black text-white font-sans selection:bg-indigo-500 selection:text-white flex flex-col md:flex-row">

    <div class="hidden md:flex w-1/3 bg-zinc-900 relative overflow-hidden items-center justify-center border-r border-white/5">
        <div class="absolute inset-0 z-0">
            <div class="absolute inset-0 opacity-20" 
                 style="background-image: radial-gradient(#444 1px, transparent 1px); background-size: 30px 30px;">
            </div>
            <div class="absolute bottom-0 left-0 w-full h-1/2 bg-gradient-to-t from-black to-transparent"></div>
        </div>
        
        <div class="relative z-10 p-12 text-center animate-in fade-in zoom-in duration-1000">
            <div class="w-20 h-20 bg-white rounded-[2rem] flex items-center justify-center mx-auto mb-8 shadow-[0_0_60px_rgba(255,255,255,0.2)] rotate-3">
                <i class="fas fa-shield-halved text-4xl text-black"></i>
            </div>
            <h1 class="text-5xl font-black tracking-tighter mb-4">FlipTrybe</h1>
            <p class="text-zinc-500 font-bold tracking-[0.3em] text-[10px] uppercase">Protocol // V.5.0.1</p>
        </div>
    </div>

    <div class="w-full md:w-2/3 relative flex items-center justify-center p-8 md:p-20 overflow-y-auto">
        <div class="w-full max-w-2xl">
            
            <div class="mb-12 flex items-end justify-between border-b border-white/5 pb-8">
                <div>
                    <h2 class="text-4xl font-black tracking-tighter mb-2">Initialize Account</h2>
                    <p class="text-xs font-black text-indigo-500 uppercase tracking-[0.3em]" id="accountTypeLabel">Standard Protocol</p>
                </div>
                <div class="text-right hidden sm:block">
                    <p class="text-[9px] text-zinc-600 uppercase font-black tracking-widest mb-1">Security Status</p>
                    <div class="flex items-center justify-end gap-2">
                        <span class="w-2 h-2 bg-emerald-500 rounded-full animate-pulse shadow-[0_0_10px_#10b981]"></span>
                        <span class="text-[10px] text-emerald-500 font-black tracking-widest uppercase">Encrypted</span>
                    </div>
                </div>
            </div>

            {% with messages = get_flashed_messages(with_categories=true) %}
                {% if messages %}
                    {% for category, message in messages %}
                        <div class="mb-8 p-5 rounded-2xl bg-rose-500/10 border border-rose-500/20 text-rose-500 text-xs font-bold uppercase tracking-widest flex items-center gap-3">
                            <i class="fas fa-triangle-exclamation"></i> {{ message }}
                        </div>
                    {% endfor %}
                {% endif %}
            {% endwith %}

            <form method="POST" action="{{ url_for('auth.register') }}" enctype="multipart/form-data" class="space-y-12">
                {{ form.hidden_tag() }}

                <div class="grid grid-cols-3 p-1.5 bg-zinc-900/50 rounded-3xl border border-white/5 relative backdrop-blur-xl">
                    <label class="cursor-pointer relative z-10">
                        <input type="radio" name="role" value="user" checked onclick="updateForm('user')" class="peer sr-only">
                        <div class="py-4 text-center rounded-2xl text-zinc-500 font-black text-[9px] uppercase tracking-widest transition-all duration-500 peer-checked:bg-white peer-checked:text-black peer-checked:shadow-2xl">
                            User
                        </div>
                    </label>
                    <label class="cursor-pointer relative z-10">
                        <input type="radio" name="role" value="agent" onclick="updateForm('agent')" class="peer sr-only">
                        <div class="py-4 text-center rounded-2xl text-zinc-500 font-black text-[9px] uppercase tracking-widest transition-all duration-500 peer-checked:bg-white peer-checked:text-black peer-checked:shadow-2xl">
                            Agent
                        </div>
                    </label>
                    <label class="cursor-pointer relative z-10">
                        <input type="radio" name="role" value="driver" onclick="updateForm('driver')" class="peer sr-only">
                        <div class="py-4 text-center rounded-2xl text-zinc-500 font-black text-[9px] uppercase tracking-widest transition-all duration-500 peer-checked:bg-white peer-checked:text-black peer-checked:shadow-2xl">
                            Driver
                        </div>
                    </label>
                </div>

                <div class="space-y-10">
                    <div class="flex items-center gap-4">
                        <span class="text-[9px] font-black text-indigo-500 uppercase tracking-[0.4em]">01 // Identity Context</span>
                        <div class="flex-grow h-px bg-white/5"></div>
                    </div>

                    <div class="grid md:grid-cols-2 gap-10">
                        <div class="group relative">
                            <label class="text-[9px] font-black uppercase text-zinc-600 mb-2 block tracking-widest">Full Legal Name</label>
                            <input type="text" name="name" required placeholder="John Doe"
                                   class="w-full bg-zinc-900/50 border border-white/5 rounded-2xl px-6 py-4 font-bold text-white focus:border-white focus:ring-4 focus:ring-white/5 outline-none transition-all duration-300">
                        </div>
                        <div class="group relative">
                            <label class="text-[9px] font-black uppercase text-zinc-600 mb-2 block tracking-widest">Network Username</label>
                            {{ form.username(class="w-full bg-zinc-900/50 border border-white/5 rounded-2xl px-6 py-4 font-bold text-white focus:border-white focus:ring-4 focus:ring-white/5 outline-none transition-all duration-300", placeholder="johndoe_hub") }}
                        </div>
                    </div>

                    <div class="group relative">
                        <label class="text-[9px] font-black uppercase text-zinc-600 mb-2 block tracking-widest">Email Address</label>
                        {{ form.email(class="w-full bg-zinc-900/50 border border-white/5 rounded-2xl px-6 py-4 font-bold text-white focus:border-white focus:ring-4 focus:ring-white/5 outline-none transition-all duration-300", placeholder="signal@fliptrybe.com") }}
                    </div>

                    <div class="grid md:grid-cols-2 gap-10">
                        <div class="group relative">
                            <label class="text-[9px] font-black uppercase text-zinc-600 mb-2 block tracking-widest">Access Key (Password)</label>
                            {{ form.password(class="w-full bg-zinc-900/50 border border-white/5 rounded-2xl px-6 py-4 font-bold text-white focus:border-white focus:ring-4 focus:ring-white/5 outline-none transition-all duration-300") }}
                        </div>
                        <div class="group relative">
                            <label class="text-[9px] font-black uppercase text-zinc-600 mb-2 block tracking-widest">Verify Access Key</label>
                            {{ form.confirm_password(class="w-full bg-zinc-900/50 border border-white/5 rounded-2xl px-6 py-4 font-bold text-white focus:border-white focus:ring-4 focus:ring-white/5 outline-none transition-all duration-300") }}
                        </div>
                    </div>
                </div>

                <div class="space-y-10">
                    <div class="flex items-center gap-4">
                        <span class="text-[9px] font-black text-emerald-500 uppercase tracking-[0.4em]">02 // Sector Coordinates</span>
                        <div class="flex-grow h-px bg-white/5"></div>
                    </div>

                    <div class="group relative">
                        <label class="text-[9px] font-black uppercase text-zinc-600 mb-2 block tracking-widest">Ground Address</label>
                        <input type="text" name="address" required placeholder="No. 15 Tech Haven, Sector 7"
                               class="w-full bg-zinc-900/50 border border-white/5 rounded-2xl px-6 py-4 font-bold text-white focus:border-white outline-none transition-all">
                    </div>

                    <div class="grid md:grid-cols-2 gap-10">
                        <div class="group relative">
                            <label class="text-[9px] font-black uppercase text-zinc-600 mb-2 block tracking-widest">Regional Hub (State)</label>
                            <input type="text" name="state" required placeholder="Lagos"
                                   class="w-full bg-zinc-900/50 border border-white/5 rounded-2xl px-6 py-4 font-bold text-white focus:border-white outline-none transition-all">
                        </div>
                        <div class="group relative">
                            <label class="text-[9px] font-black uppercase text-zinc-600 mb-2 block tracking-widest">Local Sector (City)</label>
                            <input type="text" name="city" required placeholder="Lekki"
                                   class="w-full bg-zinc-900/50 border border-white/5 rounded-2xl px-6 py-4 font-bold text-white focus:border-white outline-none transition-all">
                        </div>
                    </div>

                    <div class="grid md:grid-cols-2 gap-10">
                        <div class="group relative">
                            <label class="text-[9px] font-black uppercase text-zinc-600 mb-2 block tracking-widest">Primary Comm (Phone)</label>
                            <input type="tel" name="phone" required placeholder="+234..."
                                   class="w-full bg-zinc-900/50 border border-white/5 rounded-2xl px-6 py-4 font-bold text-white focus:border-white outline-none transition-all">
                        </div>
                        <div class="group relative">
                            <label class="text-[9px] font-black uppercase text-zinc-600 mb-2 block tracking-widest">Signal Hub (WhatsApp)</label>
                            <input type="tel" name="whatsapp" required placeholder="+234..."
                                   class="w-full bg-zinc-900/50 border border-white/5 rounded-2xl px-6 py-4 font-bold text-white focus:border-white outline-none transition-all">
                        </div>
                    </div>
                </div>

                <div class="space-y-10 pt-4">
                    <div class="flex items-center gap-4">
                        <span class="text-[9px] font-black text-rose-500 uppercase tracking-[0.4em]">03 // KYC Verification Protocol</span>
                        <div class="flex-grow h-px bg-white/5"></div>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="group">
                            <label class="text-[8px] font-black uppercase text-zinc-600 mb-3 block tracking-widest">Biometric Selfie</label>
                            <label class="flex flex-col items-center justify-center w-full h-40 border-2 border-zinc-800 border-dashed rounded-[2rem] cursor-pointer bg-zinc-900/30 hover:bg-zinc-800 hover:border-indigo-500/50 transition-all duration-500 overflow-hidden relative group">
                                <div class="flex flex-col items-center justify-center p-6 text-center">
                                    <i class="fas fa-camera text-xl text-zinc-600 mb-2 group-hover:text-indigo-400 transition-colors"></i>
                                    <p class="text-[9px] text-zinc-500 uppercase tracking-widest file-name">Capture Face</p>
                                </div>
                                <input type="file" name="kyc_selfie" accept="image/*" required class="hidden" onchange="updateFileName(this)">
                            </label>
                        </div>

                        <div id="idField" class="group hidden animate-in fade-in slide-in-from-right-4 duration-500">
                            <label class="text-[8px] font-black uppercase text-zinc-600 mb-3 block tracking-widest">Identity Document</label>
                            <label class="flex flex-col items-center justify-center w-full h-40 border-2 border-zinc-800 border-dashed rounded-[2rem] cursor-pointer bg-zinc-900/30 hover:bg-zinc-800 hover:border-emerald-500/50 transition-all duration-500 overflow-hidden relative group">
                                <div class="flex flex-col items-center justify-center p-6 text-center">
                                    <i class="fas fa-id-card text-xl text-zinc-600 mb-2 group-hover:text-emerald-400 transition-colors"></i>
                                    <p class="text-[9px] text-zinc-500 uppercase tracking-widest file-name">NIN / License</p>
                                </div>
                                <input type="file" name="kyc_id_card" accept="image/*" class="hidden" onchange="updateFileName(this)">
                            </label>
                        </div>

                        <div id="videoField" class="group hidden animate-in fade-in slide-in-from-left-4 duration-500">
                            <label class="text-[8px] font-black uppercase text-zinc-600 mb-3 block tracking-widest">Liveness Check</label>
                            <label class="flex flex-col items-center justify-center w-full h-40 border-2 border-zinc-800 border-dashed rounded-[2rem] cursor-pointer bg-zinc-900/30 hover:bg-zinc-800 hover:border-amber-500/50 transition-all duration-500 overflow-hidden relative group">
                                <div class="flex flex-col items-center justify-center p-6 text-center">
                                    <i class="fas fa-video text-xl text-zinc-600 mb-2 group-hover:text-amber-400 transition-colors"></i>
                                    <p class="text-[9px] text-zinc-500 uppercase tracking-widest file-name">5s Verify Video</p>
                                </div>
                                <input type="file" name="kyc_video" accept="video/*" class="hidden" onchange="updateFileName(this)">
                            </label>
                        </div>

                        <div id="plateField" class="group hidden animate-in fade-in slide-in-from-bottom-4 duration-500">
                            <label class="text-[8px] font-black uppercase text-zinc-600 mb-3 block tracking-widest">Asset Identification</label>
                            <label class="flex flex-col items-center justify-center w-full h-40 border-2 border-zinc-800 border-dashed rounded-[2rem] cursor-pointer bg-zinc-900/30 hover:bg-zinc-800 hover:border-white transition-all duration-500 overflow-hidden relative group">
                                <div class="flex flex-col items-center justify-center p-6 text-center">
                                    <i class="fas fa-barcode text-xl text-zinc-600 mb-2 group-hover:text-white transition-colors"></i>
                                    <p class="text-[9px] text-zinc-500 uppercase tracking-widest file-name">Plate Number Photo</p>
                                </div>
                                <input type="file" name="kyc_plate" accept="image/*" class="hidden" onchange="updateFileName(this)">
                            </label>
                        </div>
                    </div>
                </div>

                <div class="pt-12">
                    {{ form.submit(class="w-full bg-white text-black py-6 rounded-3xl font-black text-[11px] uppercase tracking-[0.4em] hover:bg-indigo-500 hover:text-white hover:shadow-2xl hover:shadow-indigo-500/20 transition-all duration-500 cursor-pointer active:scale-95") }}
                    
                    <p class="text-center text-[8px] text-zinc-600 mt-8 font-black uppercase tracking-[0.3em]">
                        Handshaking with HQ // Secure Protocol Active
                    </p>
                    <div class="text-center mt-6">
                        <a href="{{ url_for('auth.login') }}" class="text-[10px] font-black text-zinc-500 hover:text-white transition-colors uppercase tracking-[0.2em] border-b border-white/5 pb-2">
                            Signal Existing Terminal
                        </a>
                    </div>
                </div>

            </form>
        </div>
    </div>
</div>

<script>
    function updateFileName(input) {
        if (input.files && input.files[0]) {
            const label = input.parentElement.querySelector('.file-name');
            label.innerText = input.files[0].name.substring(0, 20) + "...";
            label.classList.add('text-white', 'font-black');
            input.parentElement.classList.add('border-white', 'bg-zinc-800', 'shadow-2xl');
        }
    }

    function updateForm(role) {
        const idField = document.getElementById('idField');
        const videoField = document.getElementById('videoField');
        const plateField = document.getElementById('plateField');
        const accountLabel = document.getElementById('accountTypeLabel');

        // Reset Visibility
        idField.classList.add('hidden');
        videoField.classList.add('hidden');
        plateField.classList.add('hidden');

        if (role === 'user') {
            accountLabel.innerText = "Personal Protocol";
            accountLabel.classList.replace('text-emerald-400', 'text-indigo-500');
            accountLabel.classList.replace('text-amber-400', 'text-indigo-500');
        } 
        else if (role === 'agent') {
            accountLabel.innerText = "Authorized Agency Terminal";
            accountLabel.classList.replace('text-indigo-500', 'text-amber-400');
            idField.classList.remove('hidden');
            videoField.classList.remove('hidden');
        } 
        else if (role === 'driver') {
            accountLabel.innerText = "Logistics Unit Partner";
            accountLabel.classList.replace('text-indigo-500', 'text-emerald-400');
            idField.classList.remove('hidden');
            videoField.classList.remove('hidden');
            plateField.classList.remove('hidden');
        }
    }

    // Initial State Check
    window.onload = function() {
        const selectedRole = document.querySelector('input[name="role"]:checked').value;
        updateForm(selectedRole);
    };
</script>
{% endblock %}