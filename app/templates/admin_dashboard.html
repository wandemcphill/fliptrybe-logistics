{% extends "base.html" %}
{% block content %}
<div class="max-w-6xl mx-auto px-6 py-8">
    
    <div class="flex items-center justify-between mb-10">
        <div>
            <h1 class="text-4xl font-black text-gray-900 mb-1">Command Center</h1>
            <p class="text-gray-500 font-medium">Welcome, Admin {{ current_user.name }}</p>
        </div>
        <div class="text-right">
            <p class="text-xs font-bold text-gray-400 uppercase tracking-widest">Platform Revenue (5%)</p>
            <p class="text-4xl font-black text-green-600">‚Ç¶{{ "{:,.0f}".format(revenue) }}</p>
            <p class="text-xs text-gray-400">Total Volume: ‚Ç¶{{ "{:,.0f}".format(volume) }}</p>
        </div>
    </div>

    <div class="grid lg:grid-cols-3 gap-8">
        
        <div class="lg:col-span-2">
            <h2 class="text-xl font-bold mb-6 flex items-center gap-2">
                <i class="fas fa-gavel text-red-500"></i> Active Disputes
            </h2>

            {% if disputes %}
                {% for dispute in disputes %}
                <div class="bg-white border rounded-2xl p-6 mb-4 shadow-sm relative overflow-hidden">
                    {% if dispute.is_emergency %}
                    <div class="absolute top-0 right-0 bg-red-600 text-white text-[10px] font-black px-3 py-1 uppercase tracking-widest">
                        SOS EMERGENCY
                    </div>
                    {% endif %}

                    <div class="flex justify-between items-start mb-4">
                        <div>
                            <p class="text-xs font-bold text-gray-400 uppercase mb-1">Order #{{ dispute.order.id }} ‚Ä¢ ‚Ç¶{{ "{:,.0f}".format(dispute.order.total_price) }}</p>
                            <h3 class="font-bold text-lg">{{ dispute.reason }}</h3>
                            <p class="text-sm text-gray-600 mt-1 bg-gray-50 p-3 rounded-lg">"{{ dispute.details }}"</p>
                        </div>
                    </div>

                    <div class="flex gap-3 border-t pt-4 mt-2">
                        <form action="{{ url_for('main.resolve_dispute', dispute_id=dispute.id, action='refund_buyer') }}" method="POST" class="flex-1">
                            <button class="w-full py-3 rounded-xl border-2 border-red-100 text-red-600 font-bold text-xs hover:bg-red-50 transition">
                                ‚Ü©Ô∏è REFUND BUYER
                            </button>
                        </form>
                        <form action="{{ url_for('main.resolve_dispute', dispute_id=dispute.id, action='release_agent') }}" method="POST" class="flex-1">
                            <button class="w-full py-3 rounded-xl bg-green-600 text-white font-bold text-xs hover:bg-green-700 transition shadow-lg">
                                üí∏ RELEASE FUNDS
                            </button>
                        </form>
                    </div>
                </div>
                {% endfor %}
            {% else %}
                <div class="bg-gray-50 rounded-2xl p-10 text-center text-gray-400">
                    <i class="fas fa-check-circle text-4xl mb-3 text-gray-300"></i>
                    <p>All Quiet on the Western Front.</p>
                </div>
            {% endif %}
        </div>

        <div>
            <h2 class="text-xl font-bold mb-6">User Database</h2>
            <div class="bg-white border rounded-2xl shadow-sm overflow-hidden">
                <table class="w-full text-left text-sm">
                    <thead class="bg-gray-50 text-gray-500 font-bold text-xs uppercase">
                        <tr>
                            <th class="p-4">User</th>
                            <th class="p-4 text-right">Action</th>
                        </tr>
                    </thead>
                    <tbody class="divide-y">
                        {% for user in users %}
                        <tr class="hover:bg-gray-50 transition">
                            <td class="p-4">
                                <p class="font-bold text-gray-900">{{ user.name }}</p>
                                <p class="text-xs text-gray-500">{{ user.email }}</p>
                                <div class="flex gap-1 mt-1">
                                    {% if user.is_admin %}<span class="bg-black text-white text-[9px] px-1.5 rounded">ADMIN</span>{% endif %}
                                    {% if user.is_agent %}<span class="bg-blue-100 text-blue-700 text-[9px] px-1.5 rounded">AGENT</span>{% endif %}
                                    {% if user.is_driver %}<span class="bg-yellow-100 text-yellow-700 text-[9px] px-1.5 rounded">DRIVER</span>{% endif %}
                                </div>
                            </td>
                            <td class="p-4 text-right">
                                {% if not user.is_admin %}
                                <form action="{{ url_for('main.delete_user', user_id=user.id) }}" method="POST" onsubmit="return confirm('Ban this user? This cannot be undone.');">
                                    <button class="text-red-400 hover:text-red-600 font-bold text-xs">BAN</button>
                                </form>
                                {% endif %}
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>

    </div>
</div>
{% endblock %}